# 🎯 部署前检查清单

## 📋 部署前准备

### 系统要求
- [ ] Docker 20.10+ 已安装
- [ ] Docker Compose 2.0+ 已安装
- [ ] 至少 2GB 可用内存
- [ ] 至少 5GB 可用磁盘空间
- [ ] 端口 5000（或自定义端口）未被占用
- [ ] 如使用 Nginx，端口 80/443 未被占用

### 配置文件
- [ ] 创建 `.env` 文件（从 `.env.example` 复制）
- [ ] 设置强 `SECRET_KEY`（使用 `openssl rand -hex 32`）
- [ ] 配置 AI API 密钥（如需要）
- [ ] 检查文件上传大小限制

### 数据目录
- [ ] 确保 `data/` 目录权限正确（755 或 700）
- [ ] 确保 `logs/` 目录权限正确（755 或 700）
- [ ] 计划数据备份策略

## 🚀 部署步骤

### 1. 构建镜像
- [ ] 运行 `cd deploy && ./build.sh`
- [ ] 确认镜像构建成功
- [ ] 检查镜像大小合理

### 2. 首次启动
- [ ] 运行 `./start.sh`
- [ ] 选择正确的部署模式（生产/开发）
- [ ] 等待容器启动完成

### 3. 验证部署
- [ ] 检查容器状态：`docker-compose ps`（所有容器应为 Up）
- [ ] 测试健康检查：`curl http://localhost:5000/auth/status`
- [ ] 查看日志无错误：`./logs.sh`
- [ ] 访问网页：http://localhost:5000

### 4. 首次配置
- [ ] 使用默认账号登录（admin/admin_pw_123）
- [ ] ⚠️ **立即修改管理员密码**
- [ ] 测试文件上传功能
- [ ] 测试命令执行功能（仅管理员）
- [ ] 创建普通用户测试权限

## 🔒 安全加固

### 必做项（生产环境）
- [ ] 修改默认管理员密码
- [ ] 设置强 SECRET_KEY（至少 32 字符）
- [ ] 限制文件上传大小
- [ ] 配置 HTTPS（使用 Let's Encrypt）
- [ ] 设置防火墙规则
- [ ] 禁用 Flask DEBUG 模式
- [ ] 限制容器资源使用

### 推荐项
- [ ] 启用 Nginx 速率限制
- [ ] 配置 fail2ban
- [ ] 设置日志轮转
- [ ] 启用访问日志
- [ ] 配置 CORS 策略
- [ ] 添加 CSRF 保护
- [ ] 定期安全扫描

## 📊 监控配置

### 基础监控
- [ ] 配置容器健康检查
- [ ] 监控磁盘空间使用
- [ ] 监控日志文件大小
- [ ] 设置资源限制告警

### 高级监控（可选）
- [ ] 集成 Prometheus
- [ ] 配置 Grafana 仪表板
- [ ] 设置邮件/Slack 告警
- [ ] 配置应用性能监控（APM）

## 💾 备份策略

### 自动备份
- [ ] 配置定时备份（cron）
- [ ] 测试备份脚本：`./backup.sh`
- [ ] 验证备份文件完整性
- [ ] 设置备份保留策略（如保留 7 天）

### 恢复测试
- [ ] 测试恢复脚本：`./restore.sh`
- [ ] 验证恢复后数据完整性
- [ ] 记录恢复时间（RTO）
- [ ] 确认备份存储位置安全

## 🌐 网络配置

### 域名和 DNS
- [ ] 配置域名解析
- [ ] 设置 A 记录指向服务器 IP
- [ ] 配置 SSL 证书（Let's Encrypt）
- [ ] 测试 HTTPS 访问

### 反向代理（如使用）
- [ ] 配置 Nginx/Apache
- [ ] 设置正确的 proxy headers
- [ ] 配置静态文件缓存
- [ ] 启用 gzip 压缩

## 📈 性能优化

### 应用层
- [ ] 调整 Gunicorn workers 数量
- [ ] 配置连接超时
- [ ] 启用数据库连接池
- [ ] 优化静态文件服务

### 系统层
- [ ] 调整系统文件描述符限制
- [ ] 配置 Docker 日志驱动
- [ ] 优化容器资源分配
- [ ] 启用 swap（如需要）

## 🔄 更新和维护

### 日常维护
- [ ] 定期检查日志
- [ ] 监控磁盘使用
- [ ] 检查容器健康状态
- [ ] 清理旧备份文件

### 应用更新
- [ ] 制定更新计划
- [ ] 备份数据
- [ ] 测试更新（在测试环境）
- [ ] 准备回滚方案
- [ ] 更新后验证功能

## 📝 文档和记录

### 部署文档
- [ ] 记录服务器配置
- [ ] 记录网络拓扑
- [ ] 记录访问凭证（安全存储）
- [ ] 记录常见问题解决方案

### 操作手册
- [ ] 启动/停止流程
- [ ] 备份/恢复流程
- [ ] 故障排查流程
- [ ] 紧急联系方式

## ✅ 最终检查

### 功能测试
- [ ] 用户注册/登录正常
- [ ] 文件上传/下载正常
- [ ] 命令执行正常（管理员）
- [ ] 日志查看正常（登录用户）
- [ ] 权限控制正确

### 性能测试
- [ ] 响应时间 < 2秒
- [ ] 并发用户测试通过
- [ ] 文件上传稳定
- [ ] 内存使用正常

### 安全测试
- [ ] SQL 注入测试
- [ ] XSS 攻击测试
- [ ] 文件上传安全测试
- [ ] 权限绕过测试
- [ ] 密码强度检查

## 🎉 部署完成

所有检查项完成后，你的 Tiny Agent 已经可以投入使用了！

**推荐的后续步骤：**
1. 监控首周运行情况
2. 收集用户反馈
3. 优化性能瓶颈
4. 定期安全审计

---

**部署日期**: __________  
**部署人员**: __________  
**服务器地址**: __________  
**备注**: __________
